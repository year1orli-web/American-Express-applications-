<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Double King Estate — Davicity & Sunview Kuje</title>
  <meta name="description" content="Promotional listings for Davicity & Sunview — responsive site with Firebase-powered listings." />

  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <style>
    :root{
      --accent:#d62828; /* red */
      --muted:#6b7280;
      --card-bg:#ffffff;
      --glass: rgba(255,255,255,0.85);
      --shadow: 0 8px 20px rgba(15,23,42,0.08);
      --max-width:1200px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#f7fafc, #fff);color:#0f172a;}
    .site{max-width:var(--max-width);margin:24px auto;padding:16px}

    header{display:flex;align-items:center;gap:16px}
    .logo{display:flex;align-items:center;gap:12px}
    .logo img{height:56px;width:auto}
    .brand{font-weight:700;font-size:20px}
    .tag{color:var(--muted);font-size:13px}
    nav{margin-left:auto}
    nav a{text-decoration:none;padding:8px 12px;border-radius:8px;color:var(--muted)}
    nav a.btn{background:var(--accent);color:white}

    .hero{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:18px;align-items:center}
    .hero-card{background:var(--card-bg);padding:20px;border-radius:16px;box-shadow:var(--shadow)}
    .hero-copy h1{margin:0;font-size:28px}
    .hero-copy p{color:var(--muted);margin:8px 0 0}

    .promo-strip{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
    .badge{background:var(--accent);color:white;padding:8px 12px;border-radius:10px;font-weight:700}
    .meta{color:var(--muted);font-size:14px}

    /* Sections */
    section.section{margin-top:22px}
    .section-head{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .section-title{font-size:20px;font-weight:700}
    .section-sub{color:var(--muted);font-size:13px}

    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-top:12px}
    .card{background:var(--card-bg);border-radius:12px;overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .card .img{height:160px;display:block;background:#e6eef6;position:relative}
    .card img{width:100%;height:100%;object-fit:cover;display:block}
    .card .body{padding:12px}
    .card .title{font-weight:700;font-size:15px}
    .card .price{margin-top:6px;font-weight:800;color:var(--accent)}
    .card .specs{color:var(--muted);font-size:13px;margin-top:6px}
    .card .cta{margin-top:10px;display:flex;gap:8px}
    .btn{padding:8px 10px;border-radius:8px;text-decoration:none;border:none;cursor:pointer}
    .btn.primary{background:var(--accent);color:white}
    .btn.ghost{background:transparent;border:1px solid #e6e9ef}

    footer{margin-top:32px;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(214,40,40,0.06), rgba(214,40,40,0.02));display:flex;align-items:center;justify-content:space-between}

    /* Responsive */
    @media (max-width:880px){
      .hero{grid-template-columns:1fr}
      .logo img{height:48px}
    }

    /* small helpers */
    .muted{color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center}

    /* loader */
    .loader{height:6px;background:#f1f5f9;border-radius:999px;overflow:hidden}
    .loader > i{display:block;height:100%;width:0;background:linear-gradient(90deg,#fde68a,#fca5a5);animation:load 3s linear infinite}
    @keyframes load{0%{width:0}50%{width:70%}100%{width:0}}

  </style>
</head>
<body>
  <div class="site">
    <header>
      <div class="logo">
        <img src="/favicon.png" alt="Double King Estate logo" onerror="this.style.display='none'"/>
        <div>
          <div class="brand">DOUBLE KING ESTATE LIMITED</div>
          <div class="tag">Your Realtor for Life — Kuje, FCT, Abuja</div>
        </div>
      </div>
      <nav>
        <a href="#" class="btn ghost" id="contactBtn">Contact</a>
        <a href="admin.html" class="btn btn-primary btn" style="background:var(--accent);color:#fff">Admin</a>
      </nav>
    </header>

    <main>
      <div class="hero">
        <div class="hero-card hero-copy">
          <h1>DAVICITY KUJE & SUNVIEW CITY — PROMO OFFERS</h1>
          <p>Massive promo on first 40 plots. Premium residential plots, terraces and bungalows. Prices start from affordable plans — get in touch to secure yours.</p>

          <div class="promo-strip">
            <div class="badge">Get a plot as low as 1.5M</div>
            <div class="meta">Site Location: after Handmaids Girls Secondary School Kuje</div>
            <div class="meta">Limited-time Mega Promo on every plot</div>
          </div>

          <div style="margin-top:16px">
            <div class="loader" aria-hidden="true"><i></i></div>
            <div class="muted" style="font-size:13px;margin-top:8px">Listings load from Firebase and will appear below. Images are lazy-loaded for speed.</div>
          </div>
        </div>

        <div class="hero-card">
          <div style="display:flex;align-items:center;gap:12px">
            <div style="flex:1">
              <div style="font-weight:700">Primary Promo</div>
              <div class="muted">Davicity Kuje — 2 bedroom terrace duplex with attached BQ</div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:800;font-size:20px">1.5M</div>
              <div class="muted" style="font-size:12px">Now price</div>
            </div>
          </div>
          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
            <a class="btn primary" id="callAction">Call to Reserve</a>
            <a class="btn ghost" id="whatsapp">WhatsApp</a>
          </div>
        </div>
      </div>

      <!-- Davicity Section -->
      <section class="section" id="davi">
        <div class="section-head">
          <div>
            <div class="section-title">DAVICITY KUJE</div>
            <div class="section-sub">Featured units and plot offers</div>
          </div>
          <div class="row">
            <select id="filterType" aria-label="Filter type">
              <option value="all">All</option>
              <option value="plot">Plot</option>
              <option value="house">House</option>
            </select>
            <input id="search" placeholder="Search" style="padding:8px;border-radius:8px;border:1px solid #e6eef6" />
          </div>
        </div>

        <div class="cards" id="cardsDavi">
          <!-- cards inserted by JS -->
        </div>
      </section>

      <!-- Sunview Section -->
      <section class="section" id="sun">
        <div class="section-head">
          <div>
            <div class="section-title">SUNVIEW CITY KUJE</div>
            <div class="section-sub">Now selling — select units with flexible payment plans</div>
          </div>
          <div class="row">
            <div class="muted">Contact: +234 810 234 1648</div>
          </div>
        </div>

        <div class="cards" id="cardsSun">
          <!-- cards inserted by JS -->
        </div>
      </section>

    </main>

    <footer>
      <div>
        <div style="font-weight:700">Double King Estate Limited</div>
        <div class="muted">After Handmaids Girls Secondary School Kuje, FCT-Abuja</div>
      </div>
      <div class="muted">© <span id="year"></span> — Designed for fast load and mobile-first responsiveness</div>
    </footer>
  </div>

  <!-- Firebase and app logic -->
  <!-- NOTE: replace firebaseConfig below with your project's config -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // --- Firebase config (replace with your own if different) ---
    const firebaseConfig = {
      apiKey: "AIzaSyC3Ef_ZnjmU_X2JJDbUlDYv6enGkuuW2n0",
      authDomain: "school-6425b.firebaseapp.com",
      databaseURL: "https://school-6425b-default-rtdb.firebaseio.com",
      projectId: "school-6425b",
      storageBucket: "school-6425b.firebasestorage.app",
      messagingSenderId: "929265479935",
      appId: "1:929265479935:web:af45ea5968ee50258a1cca"
    };

    // initialize
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Helper: create card element
    function makeCard(item){
      const div = document.createElement('article');
      div.className = 'card';
      div.innerHTML = `
        <div class="img"><img loading="lazy" src="${item.image || ''}" alt="${escapeHtml(item.title)}" onerror="this.style.opacity=0.9;this.style.background='#eaeaea'"/></div>
        <div class="body">
          <div class="title">${escapeHtml(item.title)}</div>
          <div class="price">${escapeHtml(item.price)}</div>
          <div class="specs">${escapeHtml(item.specs || '')}</div>
          <div class="cta">
            <button class="btn primary" onclick="reserve('${item.id}')">Reserve</button>
            <button class="btn ghost" onclick="share('${encodeURIComponent(item.title)}')">Share</button>
          </div>
        </div>`;
      return div;
    }

    function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

    // Reserve action (opens call/whatsapp)
    function reserve(id){
      // mark a click in the DB for analytics
      const p = db.ref('analytics/reservations/' + id).push();
      p.set({ts: Date.now()});
      // open whatsapp quick message
      const phone = '+2348102341648';
      window.open('https://wa.me/' + phone.replace(/\D/g,'') + '?text=' + encodeURIComponent('I want to reserve property ID: ' + id), '_blank');
    }

    function share(title){
      if(navigator.share){
        navigator.share({title: 'Double King Estate', text: title});
      } else {
        alert('Use WhatsApp to share or copy the link');
      }
    }

    // load listings grouped by project property.project = 'davi' or 'sun'
    function loadListings(){
      const ref = db.ref('properties');
      ref.on('value', snapshot => {
        const data = snapshot.val() || {};
        const arr = Object.keys(data).map(k => ({id:k, ...data[k]}));
        render(arr);
      }, err => {
        console.error('db read error', err);
      });
    }

    function render(items){
      const davi = document.getElementById('cardsDavi');
      const sun = document.getElementById('cardsSun');
      davi.innerHTML = '';
      sun.innerHTML = '';

      // simple filter / search
      const q = (document.getElementById('search').value || '').toLowerCase();
      const type = document.getElementById('filterType').value;

      items.filter(it => {
        if(type !== 'all' && it.type !== type) return false;
        if(q && !(it.title || '').toLowerCase().includes(q) && !(it.specs || '').toLowerCase().includes(q)) return false;
        return true;
      }).forEach(it => {
        const node = makeCard(it);
        if((it.project || '').toLowerCase().includes('davi')) davi.appendChild(node);
        else sun.appendChild(node);
      });

      // if empty show placeholder
      if(!davi.children.length) davi.innerHTML = '<div class="muted">No Davicity listings — add from admin.</div>';
      if(!sun.children.length) sun.innerHTML = '<div class="muted">No Sunview listings — add from admin.</div>';
    }

    // wire inputs
    document.getElementById('search').addEventListener('input', () => { loadOnce(); });
    document.getElementById('filterType').addEventListener('change', () => { loadOnce(); });

    // debounce load for search
    let _timeout;
    function loadOnce(){ clearTimeout(_timeout); _timeout = setTimeout(() => loadListings(), 250); }

    // initial load
    loadListings();

    // small performance improvement: reserve image placeholders if property image missing
    // (No external images are forced — images remain lazy-loaded.)

  </script>
</body>
</html>
